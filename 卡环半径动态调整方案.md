# 卡环直径动态调整方案

## 现状

卡环造型是基于一系列特征点的连线所生成的，目前有两种造型方式：

- 等宽直径，每个特征点的直径都是相等的；
- 渐变直径，支持起始点与终止点的直径调整，中间特征点的直径会使用插值计算，达到渐变效果。

## 目标

实现每个特征点直径的动态调整。

## 算法

1. 建立数据结构，记录卡环所有顶点距离自身最近的两个特征点；

2. 要改变某个特征点C的直径时，去查找包含此特征点C的所有顶点集合V；

3. 标记特征点C的相邻两个特征点分别为A、B；

4. 记集合V中的一点x在所画造型线上的最近点为X，记X距它的前一个特征点E的最短距离为M，距离它的下一个特征点F的距离为N；

5. 记E点的直径为D_m，F点的直径为D_n；

6. 记X点到其初始点x的向量为X_x；

7. 依据公式得到所有顶点的新位置坐标W：

   > W = ( M * D_n + N * D_m ) / ( M + N ) * X_x + X

8. 若X距A点较近，则D_x = D_a，若X距B点较近，则D_x = D_b；

9. 得到新的顶点位置后，在vtk中直接刷新位置，实现实时调整。